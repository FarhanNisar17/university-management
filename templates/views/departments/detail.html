{% extends 'base.html' %}

{% block title %}{{ dept_name }} Department{% endblock %}

{% block head_extra %}
<style>
    body { background: #f5f7fb; }
    h1 { text-align:center; margin:30px 0; font-size:32px; font-weight:700; }
    .accordion { background:#eef1ff; padding:15px 20px; margin:10px auto; width:100%; border-radius:10px; cursor:pointer; font-size:20px; font-weight:600; border-left:6px solid #4e6cff; display:flex; justify-content:space-between; align-items:center; }
    .panel { display:none; background:white; width:100%; margin-bottom:15px; padding:0; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:12px 15px; border-bottom:1px solid #e0e0e0; }
    th { background:#4e6cff; color:white; text-align:left; }
</style>
{% endblock %}

{% block content %}

    <div style="width:100%; margin:0 auto 20px; display:flex; justify-content:space-between; align-items:center;">
        <h1 style="margin:0;">{{ dept_name }}</h1>

        <div>
            <form method="get" id="sortForm" class="d-flex gap-2">
                <label style="align-self:center; font-weight:600; margin-right:6px;">Sort:</label>
                <select name="sort_by" class="form-select form-select-sm" onchange="document.getElementById('sortForm').submit();">
                    <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Alphabet (Name)</option>
                    <option value="admission_year" {% if sort_by == 'admission_year' %}selected{% endif %}>Admission Year</option>
                    <option value="gender" {% if sort_by == 'gender' %}selected{% endif %}>Gender</option>
                    <option value="category" {% if sort_by == 'category' %}selected{% endif %}>Category</option>
                </select>

                <select name="order" class="form-select form-select-sm" onchange="document.getElementById('sortForm').submit();">
                    <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
                    <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
                </select>
            </form>
        </div>
    </div>

    {% if batches %}
        {% for year, students in batches.items() %}

            <div class="accordion">Batch {{ year }} ({{ students|length }} students) <span class="arrow">â–¶</span></div>
            <div class="panel" {% if year == '2025' %}style="background: linear-gradient(135deg,#fff9e6,#fff1c6);"{% endif %}>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Parentage</th>
                            <th>DOB</th>
                            <th>Category</th>
                            <th>Gender</th>
                            <th>Email</th>
                            <th>Contact</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for s in students %}
                        <tr>
                            <td>{{ s.name }}</td>
                            <td>{{ s.parentage }}</td>
                            <td>{{ s.dob }}</td>
                            <td>{{ s.category }}</td>
                            <td>{{ s.gender }}</td>
                            <td>{{ s.email }}</td>
                            <td>{{ s.contact }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        {% endfor %}
    {% else %}
        <p class="empty-msg">No students registered in this department.</p>
    {% endif %}

    <script>
        const acc = document.querySelectorAll(".accordion");
        acc.forEach((btn) => {
            btn.addEventListener("click", () => {
                btn.classList.toggle("active");
                const panel = btn.nextElementSibling;
                if (panel.style.display === "block") panel.style.display = "none"; else panel.style.display = "block";
            });
        });
    </script>

{% endblock %}
